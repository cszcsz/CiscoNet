<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--引入bootstrap文件-->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--引入Echarts文件-->
    <script src="js/echarts.min.js"></script>
    <!--引入侧边导航栏-->
    <link href="css/htmleaf-demo.css" rel="stylesheet">
    <link href="css/nav.css" rel="stylesheet">
    <link href="fonts/iconfont.css", rel="stylesheet">
    <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="js/nav.js"></script>


    <link href="css/notiflix-1.3.0.min.css" rel="stylesheet">
    <script type="text/javascript" src="js/notiflix-1.3.0.min.js"></script>

    <!--引入cisco nextUI 拓扑图-->
    <link rel="stylesheet" href="css/next.css">
    <script src="js/next.js"></script>


    <title>网络拓扑</title>

</head>
<body>

<div id="placehold" style="width: 200px;height: 100%;float: left"></div>

<div id="main" style="float: left;">

</div>


<!--侧边栏-->
<div class="nav" style="width: 200px;height: 100%;">
    <div class="nav-top">
        <div id="mini" style="border-bottom:1px solid rgba(255,255,255,.1)"><img src="images/mini.png" ></div>
    </div>
    <ul>
        <li class="nav-item">
            <a id="a-huanjing" href="javascript:;"><i class="my-icon nav-icon icon_1"></i><span>环境管理</span><i class="my-icon nav-more"></i></a>
            <ul>
                <li><a id="nav-item-tuopu" href="javascript:;"><span>网络拓扑</span></a></li>
                <li><a id="nav-item-info" href="javascript:;"><span>流量统计</span></a></li>
                <li><a id="nav-item-yichang" href="javascript:;"><span>异常通知</span></a></li>
            </ul>
        </li>
        <li class="nav-item">
            <a href="javascript:;"><i class="my-icon nav-icon icon_2"></i><span>设备管理</span><i class="my-icon nav-more"></i></a>
            <ul>
                <li><a id="nav-item-shebei" href="javascript:;"><span>设备列表</span></a></li>
                <li><a id="nav-item-rizhi" href="javascript:;"><span>设备配置</span></a></li>
            </ul>
        </li>
        <!--<li class="nav-item">-->
            <!--<a href="javascript:;"><i class="my-icon nav-icon icon_3"></i><span>其  它</span><i class="my-icon nav-more"></i></a>-->
            <!--<ul>-->
                <!--<li><a id="nav-item-guanyu" href="javascript:;"><span>关于我们</span></a></li>-->
            <!--</ul>-->
        <!--</li>-->
    </ul>
</div>





</body>
</html>

<!--这一部分是点击跳转网页并保持导航条展开状态-->
<script type="text/javascript">
    $(document).ready(function () {
        if (!$('#a-huanjing').hasClass('nav-mini')) {
            if ($('.nav').next().css('display') == "none") {

                $('#nav-item-tuopu').css("text-decoration", "underline");
                //展开未展开
                $('.nav-item').children('ul').slideUp(0);
                $('#a-huanjing').next('ul').slideDown(0);
                $('#a-huanjing').parent('li').addClass('nav-show').siblings('li').removeClass('nav-show');
            }else{
                //收缩已展开
                $('#a-huanjing').next('ul').slideUp(300);
                $('.nav-item.nav-show').removeClass('nav-show');
            }
        }
    })




    /**
     * define application
     */
        var topoData;
        Notiflix.Loading.Init({
            cssAnimation:true,
            cssAnimationDuration:200,
            clickToClose:true,
            svgColor:"#0083b4"
        });
        Notiflix.Loading.Pulse('loading...');
        $.ajax({
            url:"http://127.0.0.1:5000/discoveryTopo",
            type:"GET",
            crossDomain:true,
            dataType:"json",
            contentType:"application/json",
            success:function (res) {
                Notiflix.Loading.Remove();   // 关闭loading界面
                console.log(res);
                topoData=res;
                    /**
                 * create application instance
                 */
                var shell = new Shell();

                /**
                 * invoke start method
                 */
                shell.start();

            },
            error:function () {
                Notiflix.Loading.Remove()   // 关闭loading界面
             }
        });





    var topologyData = {
        nodes: [
            {"id": 0, "x": 380, "y": 25, "name": "nx9kv"},
            {"id": 1, "x": 280, "y": 25, "name": "nx9kv"},
            {"id": 2, "x": 328, "y": 1, "name": "cloud"},

            {"id": 3, "x": 270, "y": 57, "name": "router1"},
            {"id": 4, "x": 392, "y": 57, "name": "router2"},

            {"id": 5, "x": 218, "y": 57, "name": "switch1"},
            {"id": 6, "x": 218, "y": 93, "name": "switch2"},
            {"id": 7, "x": 270, "y": 93, "name": "switch3"},
            {"id": 8, "x": 441, "y": 57, "name": "switch4"},
            {"id": 9, "x": 441, "y": 93, "name": "switch5"},
            {"id": 10, "x": 395, "y": 93, "name": "switch6"},

            {"id": 11, "x": 188, "y": 37, "name": "pc1"},
            {"id": 12, "x": 188, "y": 57, "name": "pc2"},
            {"id": 13, "x": 188, "y": 77, "name": "pc3"},
            {"id": 14, "x": 188, "y": 100, "name": "pc4"},
            {"id": 15, "x": 188, "y": 122, "name": "pc5"},
            {"id": 16, "x": 218, "y": 122, "name": "pc6"},
            {"id": 17, "x": 253, "y": 122, "name": "pc7"},
            {"id": 18, "x": 280, "y": 122, "name": "pc8"},
            {"id": 19, "x": 308, "y": 122, "name": "pc9"},

            {"id": 20, "x": 475, "y": 37, "name": "pc10"},
            {"id": 21, "x": 475, "y": 57, "name": "pc11"},
            {"id": 22, "x": 475, "y": 77, "name": "pc12"},
            {"id": 23, "x": 475, "y": 100, "name": "pc13"},
            {"id": 24, "x": 475, "y": 122, "name": "pc14"},
            {"id": 25, "x": 445, "y": 122, "name": "pc15"},
            {"id": 26, "x": 412, "y": 122, "name": "pc16"},
            {"id": 27, "x": 385, "y": 122, "name": "pc17"},
            {"id": 28, "x": 358, "y": 122, "name": "pc18"},
        ],
        links: [
            {"source": 0, "target": 2},
            {"source": 1, "target": 2},
            {"source": 0, "target": 1},
            {"source": 1, "target": 0},
            {"source": 3, "target": 0},
            {"source": 3, "target": 1},
            {"source": 4, "target": 0},
            {"source": 4, "target": 1},
            {"source": 5, "target": 3},
            {"source": 6, "target": 3},
            {"source": 7, "target": 3},
            {"source": 8, "target": 4},
            {"source": 9, "target": 4},
            {"source": 10, "target": 4},
            {"source": 11, "target": 5},
            {"source": 12, "target": 5},
            {"source": 13, "target": 5},
            {"source": 14, "target": 6},
            {"source": 15, "target": 6},
            {"source": 16, "target": 6},
            {"source": 17, "target": 7},
            {"source": 18, "target": 7},
            {"source": 19, "target": 7},
            {"source": 20, "target": 8},
            {"source": 21, "target": 8},
            {"source": 22, "target": 8},
            {"source": 23, "target": 9},
            {"source": 24, "target": 9},
            {"source": 25, "target": 9},
            {"source": 26, "target": 10},
            {"source": 27, "target": 10},
            {"source": 28, "target": 10},

        ]
    };

    var Shell = nx.define(nx.ui.Application, {
        properties: {
            icon: {
                value: function() {
                    return function(vertex) {
                        var id = vertex.get("id");
                        if (id>=1&&id<=3) {
                            return 'switch'
                        }
                        else if(id==0){
                            return 'cloud'
                        }
                        else if(id==4){
                            return 'wlc'
                        }
                        else if(id==5){
                            return 'accesspoint'
                        }
                    }
                }
            }
        },
        methods: {
            start: function () {
                //your application main entry

                // initialize a topology
                var topo = new nx.graphic.Topology({
                    // set the topology view's with and height
                    width: 1150,
                    height: 660,
                    // node config
                    nodeConfig: {
                        // label display name from of node's model, could change to 'model.id' to show id
                        label: 'model.name',
                        iconType: '{#icon}'
                    },
                    // link config
                    linkConfig: {
                        // multiple link type is curve, could change to 'parallel' to use parallel link
                        linkType: 'curve'
                    },
                    nodeSetConfig:{
                      iconType: 'model.deice_type'
                    },
                    // show node's icon, could change to false to show dot
                    showIcon: true
                });

                //set data to topology
                topo.data(topoData);
                //attach topology to document
                topo.attach(this);
            }
        }
    });


</script>