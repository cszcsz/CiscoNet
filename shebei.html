<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--引入bootstrap文件-->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!--引入Echarts文件-->
    <script src="js/echarts.min.js"></script>
    <!--引入侧边导航栏-->
    <link href="css/htmleaf-demo.css" rel="stylesheet">
    <link href="css/nav.css" rel="stylesheet">
    <link href="fonts/iconfont.css", rel="stylesheet">
    <script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="js/nav.js"></script>

    <link href="css/notiflix-1.3.0.min.css" rel="stylesheet">
    <script type="text/javascript" src="js/notiflix-1.3.0.min.js"></script>

    <title>设备列表</title>

    <script src="js/raydreams.js"></script>
    <script src="js/people-data.js"></script>
    <script type="text/javascript">
        // the data table itself
        var dataTable = null;
        jQuery(document).ready(function () {
            dataTable = jQuery("#dataTable").raytable({
                datasource: { data: [], keyfield: 'id' },
                columns: [

                    { field: "name", title: "设备名称", sort:true },
                    { field: "type", title: "设备类型", sort: true },
                    { field: "model", title: "设备型号" },
                    { field: "ip", title: "管理ip地址", sort: true },
                    { field: "status", title: "状态" }

                    // { field: "hostname", title: "设备名称", sort:true },
                    // { field: "type", title: "设备类型", sort: true },
                    // { field: "ip", title: "管理ip地址", sort: true },
                    // { field: "time", title: "最近更新时间" }
                ],
                pagesize: 10,
                maxPageButtons: 5,
                rowNumbers: true,
                rowClickHandler: rowAction
            });
            jQuery(".glyphicon").css('cursor', 'pointer');

            // load some default
            //doLoad(jQuery("#dataTable"));

        });

        // load some data
        function doLoad(sender) {
            Notiflix.Loading.Init({
                cssAnimation:true,
                cssAnimationDuration:400,
                clickToClose:true,
            });
            Notiflix.Loading.Dots('Please wait...');
            // $.ajax({
            //        url:"http://127.0.0.1:5000/getDeviceFromDNAC",
            //        type:"GET",
            //        crossDomain:true,
            //        dataType: "json",
            //        contentType: "application/json",
            //         success: function (res) {
            //             Notiflix.Loading.Remove()   // 关闭loading界面
            //             myData = res                 // 关键的地方
            //
            //             // how many records to bind
            //             var size = jQuery("#sizeMenu").val();
            //
            //             if (size < 0)
            //             {dataTable.data(myData,'id');}
            //             else if (size == 0)
            //             {dataTable.data([],'id');}
            //             else
            //             {dataTable.data(myData.slice(0,size),'id');}
            //
            //         },
            //         error: function () {
            //             Notiflix.Loading.Remove()   // 关闭loading界面
            //             console.log('请求失败');
            //         }
            //     });

//下面为在eve平台上写的请求，如要还原，请取消注释并把上面的注释掉
            $.ajax({
                url: "http://127.0.0.1:5000/getDeviceInfo",
                type: "GET",
                crossDomain: true,
                dataType: "json",
                contentType: "application/json",
                success: function (res) {
                    Notiflix.Loading.Remove()   // 关闭loading界面
                    var R1 = res[0].dName;
                    var R2 = res[1].dName;
                    myData[2].name = R1;
                    myData[3].name = R2;

                    // how many records to bind
                    var size = jQuery("#sizeMenu").val();

                    if (size < 0)
                    {dataTable.data(myData,'id');}
                    else if (size == 0)
                    {dataTable.data([],'id');}
                    else
                    {dataTable.data(myData.slice(0,size),'id');}

                },
                error: function () {
                    Notiflix.Loading.Remove()   // 关闭loading界面
                    console.log('请求失败');
                }
            });



        }
        // icon clicked event handler
        function iconAction(event)
        {
            // jquery to get the record ID back out
            var data = jQuery(event.target).data('ray-data');
            alert('glyph icon data is ' + data);
            //alert('You clicked the icon with data = ' + event.data.id + ' on row ' + event.data.rowIdx );
        }

        // row clicked handler
        function rowAction(event)
        {
            // jquery to get the record ID back out
            //var id = jQuery(event.target).data('ray-key');
            // alert('You clicked row ' + event.data.rowIdx + ' with object ID ' + event.data.id );
            Notiflix.Loading.Init({
                cssAnimation:true,
                cssAnimationDuration:300,
                clickToClose:true,
            });
            Notiflix.Loading.Dots('loading...');
            var mydata = "show version";
            $.ajax({
                url:"http://127.0.0.1:5000/show",
                type:"POST",
                crossDomain:true,
                data:JSON.stringify(mydata),
                dataType:"json",
                contentType:"application/json",
                success:function (res) {
                    Notiflix.Loading.Remove()   // 关闭loading界面
                    var manufacturer ="制造商:" + res.result.body.manufacturer+'<br/>';
                    var kick_file_name = "内核文件: "+res.result.body.kick_file_name;
                    var memory = "内存: "+res.result.body.memory+" kB";
                    var proc_board_id = "ID: "+res.result.body.proc_board_id;
                    var kick_tmstmp= "时间戳: "+res.result.body.kick_tmstmp;
                    Notiflix.Report.Init();
                    Notiflix.Report.Info(
                        '设备版本信息',
                        manufacturer+'\n'+kick_file_name+'\n'+memory+'\n'+proc_board_id+'\n'+kick_tmstmp,
                        "OK"
                    );
                    console.log(res.result.body);
                },
                error:function () {
                    Notiflix.Loading.Remove()   // 关闭loading界面
                }
            })

        }

        // boolean handler to determine if the cell content is rendered
        function isManager(item)
        {
            return (item.grade > 4);
        }

        // custom format handler
        function parseDate(item)
        {
            // source is ISO 8601
            var d = new Date(item.birthDate);
            return d.toDateString();
        }
    </script>

    <style type="text/css">
        #dataTable table tr:hover td { background-color: palegoldenrod; }
        /* body{background-image: url(1.gif);} */
        body{background-color:#F5F5F5 }
        #mybtn{
            background-color:#337ab7;
            border: none;
            color: white;
            padding: 8px 10px;
            margin: 5px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 15px;
            outline: none;
            box-shadow: 2px 2px 2px 1px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>

<div id="placehold" style="width: 200px;height: 100%;float: left"></div>

<div id="main" style="width: 1100px;height: 100%; float: left;margin-left: 20px;">
    <div style="margin:auto; width:80%;height: 80%;color: black">
        <h2>设备列表</h2>
        <form >
            <div class="form-group form-inline" style="margin-bottom:10px;">
                <input type="button" onclick="doLoad(this)" value="加载设备" id="mybtn" />
                <select name="sizeMenu" id="sizeMenu" class="form-control" style="width:100px;">
                    <option value="-1">All</option>
                    <option value="5">5 item</option>
                    <option value="20">20 item</option>
                    <option value="0">Empty</option>
                </select>
            </div>
        </form>
        <div id="dataTable" class="table table-striped table-bordered" cellspacing="0" width="80%">
            <!--<thead>
                <tr>
                    <th data-ray-field="firstName">First Name</th>
                    <th data-ray-field="lasName">Last Name</th>
                    <th data-ray-field="gender">Gender</th>
                    <th data-ray-field="email">Email</th>
                    <th data-ray-field="title">Title</th>
                    <th data-ray-field="city">City</th>
                </tr>
            </thead>-->
        </div>
    </div>

</div>


<!--侧边栏-->
<div class="nav" style="width: 200px;height: 100%;">
    <div class="nav-top">
        <div id="mini" style="border-bottom:1px solid rgba(255,255,255,.1)"><img src="images/mini.png" ></div>
    </div>
    <ul>
        <li class="nav-item">
            <a id="a-huanjing" href="javascript:;"><i class="my-icon nav-icon icon_1"></i><span>环境管理</span><i class="my-icon nav-more"></i></a>
            <ul>
                <li><a id="nav-item-tuopu" href="javascript:;"><span>网络拓扑</span></a></li>
                <li><a id="nav-item-info" href="javascript:;"><span>流量统计</span></a></li>
                <li><a id="nav-item-yichang" href="javascript:;"><span>异常通知</span></a></li>
            </ul>
        </li>
        <li class="nav-item">
            <a id="a-shebei" href="javascript:;"><i class="my-icon nav-icon icon_2"></i><span>设备管理</span><i class="my-icon nav-more"></i></a>
            <ul>
                <li><a id="nav-item-shebei" href="javascript:;"><span>设备列表</span></a></li>
                <li><a id="nav-item-rizhi" href="javascript:;"><span>设备配置</span></a></li>
            </ul>
        </li>
        <!--<li class="nav-item">-->
            <!--<a href="javascript:;"><i class="my-icon nav-icon icon_3"></i><span>其  它</span><i class="my-icon nav-more"></i></a>-->
            <!--<ul>-->
                <!--<li><a id="nav-item-guanyu" href="javascript:;"><span>关于我们</span></a></li>-->
            <!--</ul>-->
        <!--</li>-->
    </ul>
</div>





</body>
</html>

<!--这一部分是点击跳转网页并保持导航条展开状态-->
<script type="text/javascript">
    $(document).ready(function () {
        if (!$('#a-shebei').hasClass('nav-mini')) {
            if ($('.nav').next().css('display') == "none") {

                $('#nav-item-shebei').css("text-decoration", "underline");
                //展开未展开
                $('.nav-item').children('ul').slideUp(0);
                $('#a-shebei').next('ul').slideDown(0);
                $('#a-shebei').parent('li').addClass('nav-show').siblings('li').removeClass('nav-show');
            }else{
                //收缩已展开
                $('#a-shebei').next('ul').slideUp(300);
                $('.nav-item.nav-show').removeClass('nav-show');
            }
        }
    })


</script>